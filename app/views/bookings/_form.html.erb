<%= form_for(@booking) do |f| %>
    <% if @booking.errors.any? %>
        <div id="error_explanation">
            <h2><%= pluralize(@booking.errors.count, "error") %> prohibited this booking from being saved:</h2>

            <ul>
                <% @booking.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                <% end %>
            </ul>
        </div>
    <% end %>

    <% if @booking.ad.ad_items.count == 1 %>
        <%#= f.label :ad_item_id %>
        <%#= @booking.ad.ad_items.first.id %>
        <%= f.hidden_field(:ad_item_id, :value => @booking.ad.ad_items.first.id )%>
    <% elsif @booking.ad.ad_items.count > 0 %>
        <%= f.hidden_field(:ad_item_id, :value => @booking.ad.ad_items.first.id )%>
    <% else %>
        <%# This will fail miserably. Should never happen. %>
    <% end %>

    <div class="row">
        <div data-controller="kalendaeBookingSelector">
            <div class="eight columns">
                <div class="booking-period-selector"><div data-kalendae-container class="u-center"></div></div>
                <%#= f.hidden_field :starts_at_time, value: '00.00' %>
                <%#= f.hidden_field :ends_at_time,   value: '23.59' %>

                <div class="booking-request-summary">

                    <div class="booking-price-summary__row">
                        <span class="booking-price-summary__label">
                            Fra:
                        </span>

                        <span class="booking-price-summary__value">
                            <%= f.text_field :starts_at_date, data: { format: "yyyy.MM.dd" }, class: 'booking-price-summary__input' %>
                        </span>
                    </div>

                    <div class="booking-price-summary__row">
                        <span class="booking-price-summary__label">
                            Til:
                        </span>
                        <span class="booking-price-summary__value">
                            <%= f.text_field :ends_at_date, data: { format: "yyyy.MM.dd" }, class: 'booking-price-summary__input' %>
                        </span>
                    </div>

                    <%#= render partial: 'price_summary' %>
                    <div data-controller="bookingPriceLoader" data-url="<%= booking_calc_users_path %>">
                        <div class="booking-price-summary__row">
                            <span class="booking-price-summary__label">
                                Antall dager:
                            </span>
                            <span class="booking-price-summary__value"></span>
                        </div>
                        <div class="booking-price-summary__row">
                            <span class="booking-price-summary__label">
                                Pris per dag:
                            </span>
                            <span class="booking-price-summary__value"></span>
                        </div> 
                        <div class="booking-price-summary__row">
                            <span class="booking-price-summary__label">
                                Totalt:
                            </span>
                            <span class="booking-price-summary__value"></span>
                        </div> 
                     </div>
                 </div>

            </div>
        </div>

        <div class="row">
            <div class="seven columns">

<div class="u-push-down">
    <% if current_user.user_payment_cards.card_valid.length > 1 %>
        Velg det kredittkortet du ønsker å betale med:
        <%# would have been nice to call the field below for user_payment_card_guid %>
        <%# FIXME: auto-select favorite card %>
        <%= f.collection_select( :user_payment_card_id, @booking.from_user.user_payment_cards.card_valid.decorate, :guid, :pretty_view ) %>
    <% elsif current_user.user_payment_cards.card_valid.length == 1 %>
    Reservasjonen skal belastes på følgende kredittkort:
        <%= f.label 'user_payment_card_id', @booking.from_user.user_payment_cards.card_valid.decorate.first.pretty_view %>
        <%= f.hidden_field 'user_payment_card_id', value: @booking.from_user.user_payment_cards.card_valid.decorate.first.guid %>
    <% elsif current_user.user_payment_cards.card_valid.length < 1 %>

Du må registrere kredittkortet ditt før du kan sende en forespørsel.
    <% end %>
</div>


            </div>
        </div>

    <div class="help-box">
        Om du har dekning på kredittkortet ditt, sendes forespørselen
        til utleieren. Du blir kun belastet om din forespørsel blir
        godkjent av utleier. Dersom ikke, blir pengene tilbakeført til
        din konto.
    </div>


        <div class="actions u-push-down">
            <% unless current_user.user_payment_cards.length == 0 %>
                <%= f.submit class: "button button-primary", data: {controller: 'disableOnSubmit'} %>
            <% else %>
            Du må ha registrert ditt kredittkort før du kan gjennomføre en booking. Du kan registrere ditt kredittkort <%= link_to 'HERE', new_user_payment_card_path %>.
            <% end %>
        </div>

    <p>
      <%= image_tag "logos/mangopay_powered_590x53.png", alt: "Powered by MangoPay", class: "", size: "270x26" %>
    </p>

    </div>
<% end %>